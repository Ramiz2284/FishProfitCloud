<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£—á—ë—Ç –∫–æ–ø—á–µ–Ω–∏—è ‚Äî –ü—Ä–æ—Å—Ç–æ–π</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è window.storage –Ω–∞ –±–∞–∑–µ localStorage,
        // –µ—Å–ª–∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç window.storage.
        if (!window.storage) {
            window.storage = {
                get: async (key) => {
                    const v = localStorage.getItem(key)
                    return v === null ? undefined : { value: v }
                },
                set: async (key, value) => {
                    localStorage.setItem(key, value)
                }
            }
        }
    </script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', system-ui, sans-serif;
            -webkit-font-smoothing: antialiased;
            -webkit-tap-highlight-color: transparent;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* iPhone optimizations */
        input,
        select,
        textarea,
        button {
            font-size: 16px !important;
            /* Prevents iOS zoom on focus */
        }

        button {
            min-height: 44px;
            /* Apple's recommended touch target */
        }

        input,
        select {
            min-height: 44px;
        }
    </style>
</head>

<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React

        function App() {
            const [view, setView] = useState('batches')
            const [batches, setBatches] = useState([])
            const [goal, setGoal] = useState(null)

            useEffect(() => {
                loadData()
            }, [])

            const loadData = async () => {
                try {
                    const batchesData = await window.storage.get('batches')
                    const goalData = await window.storage.get('goal')

                    if (batchesData) setBatches(JSON.parse(batchesData.value))
                    if (goalData) setGoal(JSON.parse(goalData.value))
                } catch (error) {
                    console.log('–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫')
                }
            }

            const saveBatches = async (newBatches) => {
                setBatches(newBatches)
                await window.storage.set('batches', JSON.stringify(newBatches))
            }

            const saveGoal = async (newGoal) => {
                setGoal(newGoal)
                await window.storage.set('goal', JSON.stringify(newGoal))
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    <div className="gradient-bg text-white p-4 shadow-lg">
                        <div className="max-w-4xl mx-auto">
                            <h1 className="text-2xl font-bold mb-1">üêü –ö–æ–ø—á–µ–Ω–∏–µ —Ä—ã–±—ã</h1>
                            <p className="text-blue-100 text-sm">–ü—Ä–æ—Å—Ç–æ–π —É—á—ë—Ç</p>
                        </div>
                    </div>

                    <div className="bg-white shadow-sm sticky top-0 z-10">
                        <div className="max-w-4xl mx-auto px-3">
                            <div className="flex gap-2 py-3 overflow-x-auto">
                                <button
                                    onClick={() => setView('batches')}
                                    className={`px-4 py-3 rounded-lg font-medium whitespace-nowrap min-w-max ${view === 'batches' ? 'bg-purple-600 text-white' : 'bg-gray-100 text-gray-700'}`}
                                >
                                    üì¶ –ü–∞—Ä—Ç–∏–∏
                                </button>
                                <button
                                    onClick={() => setView('analytics')}
                                    className={`px-4 py-3 rounded-lg font-medium whitespace-nowrap min-w-max ${view === 'analytics' ? 'bg-purple-600 text-white' : 'bg-gray-100 text-gray-700'}`}
                                >
                                    üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                                </button>
                                <button
                                    onClick={() => setView('clients')}
                                    className={`px-4 py-3 rounded-lg font-medium whitespace-nowrap min-w-max ${view === 'clients' ? 'bg-purple-600 text-white' : 'bg-gray-100 text-gray-700'}`}
                                >
                                    üë• –ö–ª–∏–µ–Ω—Ç—ã
                                </button>
                                <button
                                    onClick={() => setView('goal')}
                                    className={`px-4 py-3 rounded-lg font-medium whitespace-nowrap min-w-max ${view === 'goal' ? 'bg-purple-600 text-white' : 'bg-gray-100 text-gray-700'}`}
                                >
                                    üéØ –¶–µ–ª—å
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-4xl mx-auto p-3 pb-8">
                        {view === 'batches' && <BatchesView batches={batches} saveBatches={saveBatches} />}
                        {view === 'analytics' && <AnalyticsView batches={batches} />}
                        {view === 'clients' && <ClientsView batches={batches} />}
                        {view === 'goal' && <GoalView goal={goal} saveGoal={saveGoal} batches={batches} />}
                    </div>
                </div>
            )
        }

        // BATCHES VIEW
        function BatchesView({ batches, saveBatches }) {
            const [showForm, setShowForm] = useState(false)

            const addBatch = (batch) => {
                saveBatches([batch, ...batches])
                setShowForm(false)
            }

            const updateBatch = (id, updates) => {
                saveBatches(batches.map(b => b.id === id ? { ...b, ...updates } : b))
            }

            const deleteBatch = (id) => {
                if (confirm('–£–¥–∞–ª–∏—Ç—å –ø–∞—Ä—Ç–∏—é?')) {
                    saveBatches(batches.filter(b => b.id !== id))
                }
            }

            return (
                <div>
                    <div className="flex flex-col gap-3 mb-4">
                        <h2 className="text-2xl font-bold text-gray-800">–ü–∞—Ä—Ç–∏–∏</h2>
                        <button
                            onClick={() => setShowForm(true)}
                            className="bg-purple-600 text-white px-6 py-4 rounded-xl font-semibold hover:bg-purple-700 shadow-lg text-lg"
                        >
                            ‚ûï –ù–æ–≤–∞—è –ø–∞—Ä—Ç–∏—è
                        </button>
                    </div>

                    {showForm && (
                        <NewBatchForm onSave={addBatch} onCancel={() => setShowForm(false)} />
                    )}

                    {batches.length === 0 ? (
                        <div className="bg-white rounded-xl p-12 text-center shadow-sm">
                            <p className="text-gray-500 text-lg">–ù–µ—Ç –ø–∞—Ä—Ç–∏–π. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é!</p>
                        </div>
                    ) : (
                        <div className="space-y-4">
                            {batches.map(batch => (
                                <BatchCard
                                    key={batch.id}
                                    batch={batch}
                                    onUpdate={updateBatch}
                                    onDelete={deleteBatch}
                                />
                            ))}
                        </div>
                    )}
                </div>
            )
        }

        function NewBatchForm({ onSave, onCancel }) {
            const [fishType, setFishType] = useState('–°–µ–º–≥–∞')
            const [weekStart, setWeekStart] = useState(new Date().toISOString().split('T')[0])
            const [rawKg, setRawKg] = useState('')
            const [rawCost, setRawCost] = useState('')

            const handleSubmit = (e) => {
                e.preventDefault()

                onSave({
                    id: Date.now(),
                    fishType,
                    weekStart,
                    rawKg: parseFloat(rawKg),
                    rawCost: parseFloat(rawCost),
                    sales: [],
                    createdAt: new Date().toISOString()
                })
            }

            return (
                <div className="bg-white rounded-xl p-5 shadow-sm mb-4">
                    <h3 className="text-xl font-bold mb-4">–ù–æ–≤–∞—è –ø–∞—Ä—Ç–∏—è</h3>
                    <form onSubmit={handleSubmit} className="space-y-4">
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
                                <input
                                    type="date"
                                    value={weekStart}
                                    onChange={(e) => setWeekStart(e.target.value)}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent text-base"
                                    required
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">–í–∏–¥ —Ä—ã–±—ã</label>
                                <select
                                    value={fishType}
                                    onChange={(e) => setFishType(e.target.value)}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent text-base"
                                >
                                    <option>–°–µ–º–≥–∞</option>
                                    <option>–§–æ—Ä–µ–ª—å</option>
                                    <option>–î—Ä—É–≥–æ–µ</option>
                                </select>
                            </div>
                        </div>

                        <div className="border-t pt-4 space-y-4">
                            <h4 className="font-semibold text-gray-800 text-lg">–ó–∞–∫—É–ø–∫–∞</h4>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">–ö—É–ø–∏–ª–∏ —Ä—ã–±—ã (–∫–≥)</label>
                                <input
                                    type="number"
                                    step="0.1"
                                    value={rawKg}
                                    onChange={(e) => setRawKg(e.target.value)}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent text-base"
                                    placeholder="50"
                                    required
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">–ü–æ—Ç—Ä–∞—Ç–∏–ª–∏ (‚ÇΩ)</label>
                                <input
                                    type="number"
                                    step="0.01"
                                    value={rawCost}
                                    onChange={(e) => setRawCost(e.target.value)}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent text-base"
                                    placeholder="40000"
                                    required
                                />
                            </div>
                        </div>

                        <div className="flex flex-col gap-3 pt-4">
                            <button
                                type="submit"
                                className="w-full bg-purple-600 text-white px-6 py-4 rounded-xl font-semibold hover:bg-purple-700 text-lg"
                            >
                                –°–æ–∑–¥–∞—Ç—å –ø–∞—Ä—Ç–∏—é
                            </button>
                            <button
                                type="button"
                                onClick={onCancel}
                                className="w-full bg-gray-200 text-gray-700 px-6 py-4 rounded-xl font-semibold hover:bg-gray-300 text-lg"
                            >
                                –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                    </form>
                </div>
            )
        }

        function BatchCard({ batch, onUpdate, onDelete }) {
            const [showSales, setShowSales] = useState(false)
            const [grams, setGrams] = useState('')
            const [price, setPrice] = useState('')
            const [client, setClient] = useState('')
            const [phone, setPhone] = useState('')

            // –†–∞—Å—á—ë—Ç—ã
            const sales = batch.sales || []
            const totalSoldGrams = sales.reduce((sum, s) => sum + s.grams, 0)
            const totalSoldKg = totalSoldGrams / 1000
            const totalRevenue = sales.reduce((sum, s) => sum + s.price, 0)
            const profit = totalRevenue - batch.rawCost
            const yieldPercent = batch.rawKg > 0 ? (totalSoldKg / batch.rawKg * 100) : 0
            const lossKg = batch.rawKg - totalSoldKg
            const avgPricePerKg = totalSoldKg > 0 ? totalRevenue / totalSoldKg : 0
            const costPerKg = batch.rawKg > 0 ? batch.rawCost / batch.rawKg : 0
            const marginPerKg = avgPricePerKg - costPerKg

            const addSale = () => {
                if (!grams || !price || !client) {
                    alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è')
                    return
                }

                const newSale = {
                    id: Date.now(),
                    grams: parseFloat(grams),
                    price: parseFloat(price),
                    client,
                    phone,
                    date: new Date().toISOString()
                }

                onUpdate(batch.id, { sales: [...sales, newSale] })
                setGrams('')
                setPrice('')
                setClient('')
                setPhone('')
            }

            const removeSale = (saleId) => {
                onUpdate(batch.id, { sales: sales.filter(s => s.id !== saleId) })
            }

            return (
                <div className="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div className="bg-gradient-to-r from-purple-600 to-blue-600 text-white p-4">
                        <div className="flex justify-between items-start">
                            <div>
                                <h3 className="text-xl font-bold">{batch.fishType}</h3>
                                <p className="text-blue-100 text-sm">
                                    {new Date(batch.weekStart).toLocaleDateString('ru', { day: 'numeric', month: 'long', year: 'numeric' })}
                                </p>
                            </div>
                            <button
                                onClick={() => onDelete(batch.id)}
                                className="text-white hover:text-red-200 text-2xl p-2 -m-2 min-w-[44px] min-h-[44px] flex items-center justify-center"
                            >
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>

                    <div className="p-6">
                        {/* –ì–ª–∞–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */}
                        <div className="grid grid-cols-2 gap-3 mb-5">
                            <div className="bg-blue-50 p-4 rounded-xl">
                                <p className="text-xs text-gray-600 mb-1">–ó–∞–∫—É–ø–ª–µ–Ω–æ</p>
                                <p className="text-2xl font-bold text-blue-600">{batch.rawKg} –∫–≥</p>
                                <p className="text-xs text-gray-500">{costPerKg.toFixed(0)} ‚ÇΩ/–∫–≥</p>
                            </div>
                            <div className="bg-green-50 p-4 rounded-xl">
                                <p className="text-xs text-gray-600 mb-1">–ü—Ä–æ–¥–∞–Ω–æ</p>
                                <p className="text-2xl font-bold text-green-600">{totalSoldKg.toFixed(1)} –∫–≥</p>
                                <p className="text-xs text-gray-500">{avgPricePerKg.toFixed(0)} ‚ÇΩ/–∫–≥</p>
                            </div>
                            <div className="bg-orange-50 p-4 rounded-xl">
                                <p className="text-xs text-gray-600 mb-1">–ü–æ—Ç–µ—Ä–∏</p>
                                <p className="text-2xl font-bold text-orange-600">{lossKg.toFixed(1)} –∫–≥</p>
                                <p className="text-xs text-gray-500">{yieldPercent.toFixed(0)}% –≤—ã—Ö–æ–¥</p>
                            </div>
                            <div className={`p-4 rounded-xl ${profit >= 0 ? 'bg-green-50' : 'bg-red-50'}`}>
                                <p className="text-xs text-gray-600 mb-1">–ü—Ä–∏–±—ã–ª—å</p>
                                <p className={`text-2xl font-bold ${profit >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                    {profit >= 0 ? '+' : ''}{profit.toFixed(0)} ‚ÇΩ
                                </p>
                                <p className="text-xs text-gray-500">{marginPerKg.toFixed(0)} ‚ÇΩ/–∫–≥</p>
                            </div>
                        </div>

                        {/* –§–∏–Ω–∞–Ω—Å—ã */}
                        <div className="border-t pt-4 mb-4">
                            <div className="grid grid-cols-2 gap-3">
                                <div className="bg-red-50 p-4 rounded-xl">
                                    <p className="text-sm text-gray-600">üí∞ –í–ª–æ–∂–µ–Ω–æ</p>
                                    <p className="text-xl font-bold text-red-600">{batch.rawCost.toFixed(0)} ‚ÇΩ</p>
                                </div>
                                <div className="bg-green-50 p-4 rounded-xl">
                                    <p className="text-sm text-gray-600">üíµ –í—ã—Ä—É—á–∫–∞</p>
                                    <p className="text-xl font-bold text-green-600">{totalRevenue.toFixed(0)} ‚ÇΩ</p>
                                </div>
                            </div>
                        </div>

                        {/* –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–¥–∞–∂ */}
                        <button
                            onClick={() => setShowSales(!showSales)}
                            className="w-full bg-purple-600 text-white px-4 py-4 rounded-xl hover:bg-purple-700 font-semibold text-lg"
                        >
                            {showSales ? '‚ñ≤ –°–∫—Ä—ã—Ç—å –ø—Ä–æ–¥–∞–∂–∏' : '‚ñº –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥–∞–∂—É'}
                        </button>

                        {/* –§–æ—Ä–º–∞ –ø—Ä–æ–¥–∞–∂ */}
                        {showSales && (
                            <div className="mt-4 border-t pt-4">
                                <h4 className="font-semibold mb-4 text-gray-800 text-lg">–ù–æ–≤–∞—è –ø—Ä–æ–¥–∞–∂–∞</h4>
                                <div className="space-y-3 mb-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">–ì—Ä–∞–º–º—ã</label>
                                        <input
                                            type="number"
                                            step="1"
                                            placeholder="500"
                                            value={grams}
                                            onChange={(e) => setGrams(e.target.value)}
                                            className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent text-base"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">–°—É–º–º–∞ (‚ÇΩ)</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            placeholder="750"
                                            value={price}
                                            onChange={(e) => setPrice(e.target.value)}
                                            className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent text-base"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">–ö–ª–∏–µ–Ω—Ç</label>
                                        <input
                                            type="text"
                                            placeholder="–ò–≤–∞–Ω"
                                            value={client}
                                            onChange={(e) => setClient(e.target.value)}
                                            className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent text-base"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                                        <input
                                            type="tel"
                                            placeholder="+7 999 123-45-67"
                                            value={phone}
                                            onChange={(e) => setPhone(e.target.value)}
                                            className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent text-base"
                                        />
                                    </div>
                                </div>
                                <button
                                    onClick={addSale}
                                    className="w-full bg-green-600 text-white px-4 py-4 rounded-xl hover:bg-green-700 font-semibold text-lg"
                                >
                                    ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥–∞–∂—É
                                </button>

                                {/* –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥–∞–∂ */}
                                {sales.length > 0 && (
                                    <div className="mt-5 space-y-3">
                                        <h5 className="font-semibold text-gray-800">–ò—Å—Ç–æ—Ä–∏—è ({sales.length})</h5>
                                        {sales.slice().reverse().map(sale => (
                                            <div key={sale.id} className="flex justify-between items-center bg-gray-50 p-4 rounded-xl">
                                                <div>
                                                    <p className="font-semibold text-gray-800">{sale.client}</p>
                                                    <p className="text-sm text-gray-600">
                                                        {sale.grams}–≥ √ó {(sale.price / (sale.grams / 1000)).toFixed(0)}‚ÇΩ/–∫–≥ = {sale.price.toFixed(0)}‚ÇΩ
                                                    </p>
                                                    {sale.phone && <p className="text-xs text-gray-500 mt-1">üìû {sale.phone}</p>}
                                                </div>
                                                <button
                                                    onClick={() => removeSale(sale.id)}
                                                    className="text-red-500 hover:text-red-700 ml-3 text-xl p-2"
                                                >
                                                    ‚ùå
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            )
        }

        // ANALYTICS VIEW
        function AnalyticsView({ batches }) {
            const stats = batches.map(b => {
                const sales = b.sales || []
                const totalSoldKg = sales.reduce((sum, s) => sum + s.grams, 0) / 1000
                const totalRevenue = sales.reduce((sum, s) => sum + s.price, 0)
                const profit = totalRevenue - b.rawCost
                const yieldPercent = b.rawKg > 0 ? (totalSoldKg / b.rawKg * 100) : 0

                return { ...b, totalSoldKg, totalRevenue, profit, yieldPercent }
            })

            const totalProfit = stats.reduce((sum, s) => sum + s.profit, 0)
            const totalRevenue = stats.reduce((sum, s) => sum + s.totalRevenue, 0)
            const totalCost = stats.reduce((sum, s) => sum + s.rawCost, 0)
            const avgYield = stats.length > 0 ? stats.reduce((sum, s) => sum + s.yieldPercent, 0) / stats.length : 0
            const bestBatch = stats.length > 0 ? stats.reduce((best, b) => b.profit > best.profit ? b : best, stats[0]) : null

            return (
                <div>
                    <h2 className="text-2xl font-bold text-gray-800 mb-6">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>

                    <div className="grid grid-cols-2 gap-3 mb-6">
                        <div className="bg-white rounded-xl p-5 shadow-sm">
                            <p className="text-sm text-gray-600 mb-1">–ü–∞—Ä—Ç–∏–π</p>
                            <p className="text-3xl font-bold text-purple-600">{batches.length}</p>
                        </div>
                        <div className="bg-white rounded-xl p-5 shadow-sm">
                            <p className="text-sm text-gray-600 mb-1">–ü—Ä–∏–±—ã–ª—å</p>
                            <p className={`text-3xl font-bold ${totalProfit >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                {totalProfit >= 0 ? '+' : ''}{(totalProfit / 1000).toFixed(0)}–∫
                            </p>
                        </div>
                        <div className="bg-white rounded-xl p-5 shadow-sm">
                            <p className="text-sm text-gray-600 mb-1">–í—ã—Ö–æ–¥</p>
                            <p className="text-3xl font-bold text-blue-600">{avgYield.toFixed(0)}%</p>
                        </div>
                        <div className="bg-white rounded-xl p-5 shadow-sm">
                            <p className="text-sm text-gray-600 mb-1">ROI</p>
                            <p className="text-3xl font-bold text-orange-600">
                                {totalCost > 0 ? ((totalProfit / totalCost) * 100).toFixed(0) : 0}%
                            </p>
                        </div>
                    </div>

                    {stats.length > 0 && (
                        <div className="bg-white rounded-xl shadow-sm p-6">
                            <h3 className="text-xl font-bold mb-4">–ò—Å—Ç–æ—Ä–∏—è –ø–∞—Ä—Ç–∏–π</h3>
                            <div className="space-y-3">
                                {stats.slice().reverse().map(batch => (
                                    <div key={batch.id} className="border-b pb-3 last:border-b-0">
                                        <div className="flex justify-between items-start mb-2">
                                            <div>
                                                <p className="font-semibold text-gray-800">
                                                    {batch.fishType} ‚Äî {new Date(batch.weekStart).toLocaleDateString('ru')}
                                                </p>
                                                <p className="text-sm text-gray-600">
                                                    {batch.rawKg}–∫–≥ ‚Üí {batch.totalSoldKg.toFixed(1)}–∫–≥ (–≤—ã—Ö–æ–¥ {batch.yieldPercent.toFixed(0)}%)
                                                </p>
                                            </div>
                                            <div className="text-right">
                                                <p className={`text-lg font-bold ${batch.profit >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                                    {batch.profit >= 0 ? '+' : ''}{batch.profit.toFixed(0)} ‚ÇΩ
                                                </p>
                                                <p className="text-xs text-gray-500">
                                                    {batch.rawCost.toFixed(0)}‚ÇΩ ‚Üí {batch.totalRevenue.toFixed(0)}‚ÇΩ
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {stats.length === 0 && (
                        <div className="bg-white rounded-xl p-12 text-center shadow-sm">
                            <p className="text-gray-500 text-lg">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>
                        </div>
                    )}
                </div>
            )
        }

        // CLIENTS VIEW
        function ClientsView({ batches }) {
            const clientMap = {}

            batches.forEach(batch => {
                (batch.sales || []).forEach(sale => {
                    if (!clientMap[sale.client]) {
                        clientMap[sale.client] = {
                            name: sale.client,
                            phone: sale.phone,
                            totalSpent: 0,
                            totalKg: 0,
                            purchaseCount: 0,
                            lastPurchase: null
                        }
                    }

                    clientMap[sale.client].totalSpent += sale.price
                    clientMap[sale.client].totalKg += sale.grams / 1000
                    clientMap[sale.client].purchaseCount += 1

                    if (!clientMap[sale.client].lastPurchase || new Date(sale.date) > new Date(clientMap[sale.client].lastPurchase)) {
                        clientMap[sale.client].lastPurchase = sale.date
                    }
                })
            })

            const clients = Object.values(clientMap).sort((a, b) => b.totalSpent - a.totalSpent)

            return (
                <div>
                    <h2 className="text-2xl font-bold text-gray-800 mb-4">–ö–ª–∏–µ–Ω—Ç—ã ({clients.length})</h2>

                    {clients.length === 0 ? (
                        <div className="bg-white rounded-xl p-12 text-center shadow-sm">
                            <p className="text-gray-500 text-lg">–ù–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤</p>
                        </div>
                    ) : (
                        <div className="space-y-3">
                            {clients.map((client, idx) => {
                                const daysSince = Math.floor((new Date() - new Date(client.lastPurchase)) / (1000 * 60 * 60 * 24))

                                return (
                                    <div key={idx} className="bg-white rounded-xl shadow-sm p-5">
                                        <div className="flex justify-between items-start mb-3">
                                            <div>
                                                <h3 className="text-lg font-bold text-gray-800">{client.name}</h3>
                                                {client.phone && <p className="text-sm text-gray-600 mt-1">üìû {client.phone}</p>}
                                            </div>
                                            {daysSince > 14 && (
                                                <span className="bg-orange-100 text-orange-700 text-xs px-2 py-1 rounded-full whitespace-nowrap">
                                                    ‚ö†Ô∏è {daysSince}–¥
                                                </span>
                                            )}
                                        </div>

                                        <div className="grid grid-cols-3 gap-3">
                                            <div className="bg-blue-50 p-3 rounded-lg text-center">
                                                <p className="text-xs text-gray-600">–†–∞–∑</p>
                                                <p className="text-lg font-bold text-blue-600">{client.purchaseCount}</p>
                                            </div>
                                            <div className="bg-green-50 p-3 rounded-lg text-center">
                                                <p className="text-xs text-gray-600">–ö–≥</p>
                                                <p className="text-lg font-bold text-green-600">{client.totalKg.toFixed(1)}</p>
                                            </div>
                                            <div className="bg-purple-50 p-3 rounded-lg text-center">
                                                <p className="text-xs text-gray-600">‚ÇΩ</p>
                                                <p className="text-lg font-bold text-purple-600">{(client.totalSpent / 1000).toFixed(0)}–∫</p>
                                            </div>
                                        </div>

                                        <p className="text-sm text-gray-500 mt-3">
                                            {new Date(client.lastPurchase).toLocaleDateString('ru', { day: 'numeric', month: 'short' })}
                                        </p>
                                    </div>
                                )
                            })}
                        </div>
                    )}
                </div>
            )
        }

        // GOAL VIEW
        function GoalView({ goal, saveGoal, batches }) {
            const [monthlyIncome, setMonthlyIncome] = useState(goal?.monthlyIncome || '')
            const [avgPricePerKg, setAvgPricePerKg] = useState(goal?.avgPricePerKg || '')
            const [avgCostPerKg, setAvgCostPerKg] = useState(goal?.avgCostPerKg || '')

            const handleSave = () => {
                saveGoal({
                    monthlyIncome: parseFloat(monthlyIncome),
                    avgPricePerKg: parseFloat(avgPricePerKg),
                    avgCostPerKg: parseFloat(avgCostPerKg)
                })
            }

            const margin = avgPricePerKg - avgCostPerKg
            const kgPerMonth = margin > 0 ? monthlyIncome / margin : 0
            const kgPerWeek = kgPerMonth / 4.33

            // –¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
            const now = new Date()
            const currentMonthBatches = batches.filter(b => {
                const d = new Date(b.weekStart)
                return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear()
            })

            const currentRevenue = currentMonthBatches.reduce((sum, b) =>
                sum + (b.sales || []).reduce((s, sale) => s + sale.price, 0), 0
            )
            const currentCost = currentMonthBatches.reduce((sum, b) => sum + b.rawCost, 0)
            const currentProfit = currentRevenue - currentCost
            const progress = goal ? (currentProfit / goal.monthlyIncome * 100) : 0

            return (
                <div>
                    <h2 className="text-2xl font-bold text-gray-800 mb-6">–¶–µ–ª—å</h2>

                    <div className="bg-white rounded-xl shadow-sm p-5 mb-5">
                        <h3 className="text-xl font-bold mb-4">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h3>
                        <div className="space-y-4 mb-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">–¶–µ–ª—å (‚ÇΩ/–º–µ—Å)</label>
                                <input
                                    type="number"
                                    value={monthlyIncome}
                                    onChange={(e) => setMonthlyIncome(e.target.value)}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 text-base"
                                    placeholder="100000"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ (‚ÇΩ/–∫–≥)</label>
                                <input
                                    type="number"
                                    value={avgPricePerKg}
                                    onChange={(e) => setAvgPricePerKg(e.target.value)}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 text-base"
                                    placeholder="1500"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ/–∫–≥)</label>
                                <input
                                    type="number"
                                    value={avgCostPerKg}
                                    onChange={(e) => setAvgCostPerKg(e.target.value)}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 text-base"
                                    placeholder="800"
                                />
                            </div>
                        </div>
                        <button
                            onClick={handleSave}
                            className="w-full bg-purple-600 text-white px-6 py-4 rounded-xl font-semibold hover:bg-purple-700 text-lg"
                        >
                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        </button>
                    </div>

                    {goal && margin > 0 && (
                        <>
                            <div className="bg-white rounded-xl shadow-sm p-5 mb-5">
                                <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω –¥–ª—è —Ü–µ–ª–∏</h3>
                                <div className="space-y-3">
                                    <div className="bg-gradient-to-br from-blue-50 to-blue-100 p-5 rounded-xl">
                                        <p className="text-sm text-gray-700 mb-1">–ú–∞—Ä–∂–∞ –∑–∞ –∫–≥</p>
                                        <p className="text-3xl font-bold text-blue-600">{margin.toFixed(0)} ‚ÇΩ</p>
                                    </div>
                                    <div className="bg-gradient-to-br from-green-50 to-green-100 p-5 rounded-xl">
                                        <p className="text-sm text-gray-700 mb-1">–ù–∞–¥–æ –≤ –º–µ—Å—è—Ü</p>
                                        <p className="text-3xl font-bold text-green-600">{kgPerMonth.toFixed(0)} –∫–≥</p>
                                    </div>
                                    <div className="bg-gradient-to-br from-purple-50 to-purple-100 p-5 rounded-xl">
                                        <p className="text-sm text-gray-700 mb-1">–ù–∞–¥–æ –≤ –Ω–µ–¥–µ–ª—é</p>
                                        <p className="text-3xl font-bold text-purple-600">{kgPerWeek.toFixed(0)} –∫–≥</p>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white rounded-xl shadow-sm p-5">
                                <h3 className="text-xl font-bold mb-4">–ü—Ä–æ–≥—Ä–µ—Å—Å</h3>
                                <div className="mb-4">
                                    <div className="flex justify-between text-sm mb-2">
                                        <span>–ó–∞ –º–µ—Å—è—Ü</span>
                                        <span className="font-semibold">{(currentProfit / 1000).toFixed(0)}–∫ / {(goal.monthlyIncome / 1000).toFixed(0)}–∫ ‚ÇΩ</span>
                                    </div>
                                    <div className="w-full bg-gray-200 rounded-full h-8">
                                        <div
                                            className="bg-gradient-to-r from-purple-600 to-blue-600 h-8 rounded-full flex items-center justify-center text-white text-sm font-bold transition-all"
                                            style={{ width: `${Math.min(progress, 100)}%` }}
                                        >
                                            {progress > 10 && `${progress.toFixed(0)}%`}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </>
                    )}
                </div>
            )
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>

</html>